define("eling/component/ui/editgrid/2.0.0/dist/editgrid",["eling/component/ui/grid/2.0.0/dist/grid","jquery/jquery-plugins/pagination/pagination","eling/component/core/uicomponent/2.0.0/src/uicomponent","base","tools","handlebars","templatable","bootstrap","gallery/handlebars/2.0.0/handlebars-seajs","eling/component/utils/tools/tools","eling/component/utils/ajaxwrapper","dialog","store"],function(a,b,c){var d=a("eling/component/ui/grid/2.0.0/dist/grid"),e=(a("gallery/handlebars/2.0.0/handlebars-seajs"),a("eling/component/utils/tools/tools")),f=d.extend({attrs:{autoRender:!0,editor:null,editors:{},model:{isInitPageBar:!1,editable:!0,allowAdd:!0,allowEdit:!0,allowFoot:!0}},initCustAttr:function(){f.superclass.initCustAttr.call(this,arguments);var a=this.get("model").columns;for(var b in a)a[b].editor&&a[b].editor.type&&(e.isString(a[b].className)?a[b].className+=" J-editgrid-edit-td":a[b].className=" J-editgrid-edit-td")},afterRender:function(){this._geneFormELParams();var a=this.get("model");a.editable&&this._addEmptyRow(),a.allowAdd===!1&&this.$("tfoot tr").eq(0).addClass("hidden"),a.allowFoot===!1&&this.$("tfoot tr").eq(1).addClass("hidden").css({display:"block"})},_addEmptyRow:function(){var a=this,b=$("<tr></tr>");this.$("tfoot tr").before(b);var c=this.get("model"),d=c.columns;for(var e in d)!function(c){var d=$("<td></td>").addClass("J-editgrid-edit-td").css({"vertical-align":"middle"}).html($("<pre></pre>"));if(c.editor&&c.editor.type){var e=$("<div></div>");d.append(e),a._initEditElement(c,e,"add")}b.append(d)}(d[e])},_initEditElement:function(a,b,c){var d=this;this.get("model");e.loadModule(a.editor.type,function(e){var f=new e({parentNode:b,model:"edit"==c?a.editParams:a.addParams});"edit"==c?d.set("editor",f):d.get("editors")[a.name]=f})},_beforeEdit:function(a,b){if(b.editor&&"select"==b.editor.type&&b.editor.url&&a){var c=this.get("editors")[b.name].getData();a.setData(c)}},_afterEdit:function(a,b){b.editor&&"select"==b.editor.type&&a.open()},_geneFormELParams:function(){var a=this.get("model"),b=a.columns;for(var c in b)!function(a,b){if(a.editor&&a.editor.type){var c=a.editor.type;c=c.substring(0,1).toUpperCase()+c.substring(1);var d="_gene"+c+"Params";b[d].call(b,a,b)}}(b[c],this)},_geneTextParams:function(a,b){a.editor.placeholder=a.editor.placeholder||"请选择"+a.label;var c=$.extend(!0,{},a.editor);c.events={change:function(c){var d=b.get("model"),f=d.onAdd||a.editor.onAdd;if(e.isFunction(f)){var g=f(b.get("editors"));if(g!==!1){var h=b.get("editors");for(var i in h)h[i].reset()}}return c.preventDefault(),c.stopPropagation(),!1}},a.addParams=c;var d=$.extend(!0,{},a.editor);d.events={change:function(c){if(e.isFunction(a.editor.onChange)){var d=b.getIndex(c.currentTarget),f=b.get("data"),g=f[d];a.editor.onChange(b.get("editor"),d,g)}return c.preventDefault(),c.stopPropagation(),!1}},a.editParams=d},_geneTextareaParams:function(a,b){this._geneTextParams(a,b)},_geneDateParams:function(a,b){a.editor.triggerType="form",this._geneTextParams(a,b)},_geneSelectParams:function(a,b){this._geneTextParams(a,b),a.editor.url&&(a.editParams.lazy=!0)},_geneAutocompleteParams:function(a,b){a.editor.placeholder=a.editor.placeholder||"请选择"+a.label;var c=$.extend(!0,{},a.editor);c.onItemSelect=function(c){var d=b.get("model"),f=d.onAdd||a.editor.onAdd;if(e.isFunction(f)){var g=f(b.get("editors"));if(g!==!1){var h=b.get("editors");for(var i in h)h[i].reset()}}},a.addParams=c;var d=$.extend(!0,{},a.editor);d.onItemSelect=function(c){if(e.isFunction(a.editor.onChange)){var d=b.getIndex(b.$(".editing")),f=b.get("data"),c=f[d];a.editor.onChange(b.get("editor"),d,c)}},a.editParams=d},_genePlaceParams:function(a,b){a.editor.placeholder=a.editor.placeholder||"请选择"+a.label;var c=$.extend(!0,{},a.editor);c.onItemSelect=function(c){var d=b.get("model"),f=d.onAdd||a.editor.onAdd;if(e.isFunction(f)){var g=f(b.get("editors"));if(g!==!1){var h=b.get("editors");for(var i in h)h[i].reset()}}},c.triggerType="form",a.addParams=c;var d=$.extend(!0,{},a.editor);d.onItemSelect=function(c){if(e.isFunction(a.editor.onChange)){var d=b.getIndex(b.$(".editing")),f=b.get("data"),c=f[d];a.editor.onChange(b.get("editor"),d,c)}},d.triggerType="form",a.editParams=d},events:function(){var a=f.superclass.events.call(this,arguments),b=this.get("model");return a["click td"]=function(a){if(b.editable&&b.allowEdit){var c=$(a.currentTarget),d=this.getIndex(c),f=$(a.currentTarget).attr("class");if(c.hasClass("editing"))return!1;var g=this.$(".editing");if(g.length&&(g.removeClass("editing"),g.find("pre").removeClass("hidden"),this.get("editor").destroy(),this.set("editor",null)),f.indexOf("J-editgrid-edit-td")){var h=this.$("."+f.split(" ")[0]).eq(d),i=h.find("pre"),j=this.getColumnConfig(h),k=this.getIndex(h),l=this.get("data"),m=l[k],n=!0;if(j.editor&&j.editor.type&&(e.isFunction(j.editor.onBeforeEdit)&&(n=j.editor.onBeforeEdit(m)),n)){h.addClass("editing"),i.addClass("hidden");var o=$("<div></div>");if(h.append(o),this._initEditElement(j,o,"edit"),this._beforeEdit(this.get("editor"),j),j.editor.onEdit)j.editor.onEdit(this.get("editor"),k,m);else{var p=i.text();this.get("editor").setValue(p)}this._afterEdit(this.get("editor"),j)}}}return a.preventDefault(),a.stopPropagation(),!1},a},add:function(a){var b=this.get("data");this.insert(b.length,a)},update:function(a,b){var c=this.get("data");c[a]=b;var d=this.$("tbody tr").eq(a),f=this.get("model"),g=f.columns;for(var h in g){var i=g[h].name,j=d.find("td.J-grid-columns-"+i.replace(/\./g,"-")).find("pre"),k=e._getValueFromObject(g[h].name,b),l=g[h].format;"string"==typeof l&&e["gridformat_"+l]?k=e["gridformat_"+l](g[h].formatparams,k,b,f):"function"==typeof l&&(k=l(k,b)),j.html(k)}},setText:function(a,b,c){var d=b.split(":"),e=d[0],f=d[1]||0;this.$("tbody tr").eq(a).find("td.J-grid-columns-"+e.replace(/\./g,"-")).eq(f).find("pre").text(c)},getText:function(a,b){var c=b.split(":"),d=c[0],e=c[1]||0;this.$("tbody tr").eq(a).find("td.J-grid-columns-"+d.replace(/\./g,"-")).eq(e).find("pre").text()},setDisabled:function(a){var b=this.get("model");b.editable=!a,a?this.$("tfoot tr").eq(0).addClass("hidden"):a||b.allowAdd!==!0||this.$("tfoot tr").eq(0).removeClass("hidden")},getPlugins:function(){return this.get("editors")},destroy:function(){this.set("editor",null);var a=this.get("editors");for(var b in a)a[b]&&a[b].destroy();this.set("editors",{}),f.superclass.destroy.call(this,arguments)}});c.exports=f});