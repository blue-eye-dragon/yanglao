define("eling/component/ui/reportgrid/1.0.0/dist/reportgrid",["eling/component/core/uicomponent/2.0.0/src/uicomponent","base","tools","handlebars","templatable","bootstrap","./reportgrid.tpl","eling/component/utils/ajaxwrapper","dialog","store","eling/component/utils/gridformat/gridformat"],function(a,b,c){var d=a("eling/component/core/uicomponent/2.0.0/src/uicomponent"),e=a("./reportgrid.tpl"),f=a("eling/component/utils/ajaxwrapper"),g=a("eling/component/utils/gridformat/gridformat");a("../css/reportgrid.css");var h=d.extend({attrs:{template:e,autoRender:!0},events:{"click .J-reportgrid-datas-td":function(a){var b=$(a.target).parents().prevAll("td[data-type='datas']").size(),c=$(a.target).parents("tr").prevAll().size(),d=this.get("model"),e=this.get("data")?this.get("data").data:null;if(e){var f=d.datas||{},g=f.click||function(){};g(e[c][b])}return!1}},setup:function(){this.render();var a=this.get("autoRender");a&&this._loadData(this.get("url"))},_loadData:function(a,b,c){var d=this,e=b||this.get("params")||"";"function"==typeof e&&(e=e());var b=f.customParam(e)||"";f.ajax({url:a,dataType:"json",type:"GET",data:b.substring(0,b.length-1),success:function(a){d._setData(a),"function"==typeof c&&c(a)}})},_calColspan:function(a,b){return a.subHeaders?(b=b||1,b*=a.subHeaders.length,this._calColspan(a.subHeaders[0],b)):b},_handleCols:function(a,b,c){var d=this.get("model")||{},e=d.colHeaders||{},f=e.format;c=c||{},b=b||0,c[b]||(c[b]=[]);for(var g=0;g<a.length;g++){var h=null;if("function"==typeof f&&(h=f(a[g].name,b)),a[g].subHeaders){c[b].push({value:h||a[g].name,colspan:this._calColspan(a[g])});var i=b+1;c[i]=c[i]||[],this._handleCols(a[g].subHeaders,i,c)}else c[b].push({value:h||a[g].name})}return c[0].rowdeep=this._getDeep(a),c[0].coldeep=this._getDeep(this.get("data").rowHeaders),c[0].isCollapse=!0,c},_getDeep:function(a,b){if(b=b||0,a.length){var c=a[0];if(b+=1,c.subHeaders)return this._getDeep(c.subHeaders,b)}return b},_getRows:function(a,b,c){var d=this.get("model")||{},e=d.rowHeaders||{},f=e.format;c=c||[],b=b||0;for(var g=0;g<a.length;g++){var h=null;"function"==typeof f&&(h=f(a[g].name,b));var i={name:h||a[g].name,rowspan:this._calColspan(a[g])};c.push(i),a[g].subHeaders&&(b++,this._getRows(a[g].subHeaders,b,c))}return c},_setData:function(a){this.set("data",a);var b=this.get("model");b.head=this._handleCols(a.colHeaders||[]),b.data=this._handleDatas(a.rowHeaders,a.data),this.renderPartial(".J-reportgrid-table")},_flattenRows:function(a){if(!a||0==a.length)return!1;var b=this._getRows(a),c={},d=0;1==b.length&&(c[0]=[{value:b[0].name,belong:"rows",rowspan:b[0].rowspan,className:"text-center"}]);for(var e=1;e<b.length;e++)c[d]||(c[d]=[]),c[d].push({value:b[e-1].name,rowspan:b[e-1].rowspan,belong:"rows",className:"text-center"}),b[e-1].rowspan||(d+=1),e==b.length-1&&(void 0===b[e].rowspan&&1!=b[e-1].rowspan&&(c[d]=[]),c[d].push({value:b[e].name,data:b[e],rowspan:b[e].rowspan,belong:"rows",className:"text-center"}));return c},_handleDatas:function(a,b){var c=this._flattenRows(a);if(c){var d=this.get("model"),e=d.datas||{},f=e.cols||[],g=e.id||"";for(var h in c){for(var i=[],j=b[h],k=0,l=0;l<j.length;l++){var m=j[l]?j[l][g]:j[l]||0;i.push({value:this._formatValue(m,j[l],k,f,e),className:f[k]&&f[k].className?f[k].className:e.className||"text-center",belong:"datas",isClick:e&&e.click?!0:!1}),k++,k=k==f.length?0:k}c[h]=c[h].concat(i)}}return c},_formatValue:function(a,b,c,d,e){var f=d[c]&&d[c].format?d[c].format:e.format||null,h=d[c]&&d[c].formatparams?d[c].formatparams:e.formatparams||null;return f&&"string"==typeof f&&(f=g[f]),"function"==typeof f?f(h,a,b):a},refresh:function(a,b){this._loadData(this.get("url"),a,b)}});c.exports=h}),define("eling/component/ui/reportgrid/1.0.0/dist/reportgrid.tpl",[],"<div class='container el-reportgrid'>\n	<div class='row'>\n		<div class='col-xs-12'>\n			<div class='row'>\n				<div class='col-sm-12'>\n					<div class='box'>\n						<div class='box-content box-no-padding autoscroll'>\n							<table class='J-reportgrid-table table table-bordered table-striped'>\n								<thead>\n									{{#each this.head}}\n    								<tr>\n    									{{#if this.isCollapse}}\n											<th rowspan=\"{{this.rowdeep}}\" colspan=\"{{this.coldeep}}\"></th>\n										{{/if}}\n	    								{{#each this}}\n	    									<th colspan=\"{{this.colspan}}\">{{this.value}}</th>\n	    								{{/each}}\n    								</tr>\n    								{{/each}}\n								</thead>\n								<tbody>\n									{{#each this.data}}\n									<tr>\n										{{#each this}}\n											<td class=\"data-td {{this.className}}\" rowspan=\"{{this.rowspan}}\" data-type = \"{{this.belong}}\">\n												{{#if this.isClick}}\n													<a href=\"javascript:void(0);\" class=\"J-reportgrid-{{this.belong}}-td\">{{this.value}}</a>\n												{{else}}\n													{{this.value}}\n												{{/if}}\n											</td>\n										{{/each}}\n									</tr>\n									{{/each}}\n                				</tbody>\n                			</table>\n		                </div>\n		            </div>\n		        </div>\n		    </div>\n		</div>\n	</div>\n</div>");